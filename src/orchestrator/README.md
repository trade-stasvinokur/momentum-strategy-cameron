# Orchestrator¬†‚Äì –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ Gap¬†Scanner‚ÄØ‚Üí‚ÄØVWAP Levels

**Orchestrator**¬†‚Äî —Ñ–æ–Ω–æ–≤—ã–π Python‚Äë—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π *–∫–∞–∂–¥—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π –¥–µ–Ω—å –≤¬†10:00¬†–ø–æ –ú–æ—Å–∫–≤–µ*:

1. –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å **Gap¬†Scanner** (`/scan`) –∏ –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ü–∏–π —Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º –≥—ç–ø–æ–º;
2. –±–µ—Ä—ë—Ç –∞–∫—Ü–∏–∏‚Äë–ª–∏–¥–µ—Ä–æ–≤ (max‚ÄØgap) –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –µ—ë –≤ —Å–µ—Ä–≤–∏—Å **VWAP¬†Levels** (`/vwap`);
3. –ø–∏—à–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Ç–∏–∫–µ—Ä,¬†gap‚ÄØ%, VWAP,¬†S/R) –≤¬†–ª–æ–≥–∏.

–≠—Ç–æ –Ω–µ HTTP‚ÄëAPI, –∞ **cron‚Äë–ø–æ–¥–æ–±–Ω—ã–π –≤–æ—Ä–∫–µ—Ä**: –∂–∏–≤—ë—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, ¬´–ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è¬ª –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (APScheduler) –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è.

---

## ‚öôÔ∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Python¬†‚â•‚ÄØ3.13**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` ‚Üí `.env` –∏ –∑–∞–¥–∞–π—Ç–µ URL‚Äô—ã —Å–µ—Ä–≤–∏—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Docker‚ÄØDNS‚Äë–∏–º–µ–Ω–∞):

```dotenv
# –∫—É–¥–∞ —Å—Ç—É—á–∞—Ç—å—Å—è –∑–∞ –≥—ç–ø–∞–º–∏
GAP_SCANNER_URL=http://gap_scanner:8000/scan
# –∫—É–¥–∞ —Å–ª–∞—Ç—å —Ç–∏–∫–µ—Ä –¥–ª—è VWAP
VWAP_LEVELS_URL=http://vwap_levels:8001/vwap
# –ª–æ–∫–∞–ª—å–Ω—ã–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å Moscow)
TZ=Europe/Moscow
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install uv
```

### 2. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
uv run orchestrator/orchestrator.py
```

–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –≤¬†stdout, –ø—Ä–∏–º–µ—Ä:

```
2025-07-28 10:00:02 INFO –õ–∏–¥–µ—Ä –ø–æ –≥—ç–ø—É: CHMK  gap=3.84%
2025-07-28 10:00:07 INFO CHMK VWAP=4‚ÄØ997.32  S=4‚ÄØ985.11  R=5‚ÄØ009.53
```

### 3. –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
docker compose up orchestrator
```

`docker-compose.yml` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä **orchestrator** –∏ —Å—Ç–∞–≤–∏—Ç –µ–≥–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `gap-scanner` –∏ `vwap-levels`.
–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–∞–º –ø–µ—Ä–µ–π–¥—ë—Ç –≤ —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º –¥–æ 10:00‚ÄØ–ú–°–ö.

---

## üß∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è        | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                   | –ß—Ç–æ –¥–∞—ë—Ç                  |
| ----------------- | ----------- | ------------------------------ | ------------------------- |
| `GAP_SCANNER_URL` | –Ω–µ—Ç         | `http://gap-scanner:8000/scan` | GET‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç Gap¬†Scanner  |
| `VWAP_LEVELS_URL` | –Ω–µ—Ç         | `http://vwap-levels:8001/vwap` | POST‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç VWAP Levels |
| `MIN_GAP`         | –Ω–µ—Ç         | `0.10` (10‚ÄØ%)                  | –ü–æ—Ä–æ–≥ –≥—ç–ø–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞     |
| `TZ`              | –Ω–µ—Ç         | `Europe/Moscow`                | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ |

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **APScheduler** (CronTrigger) –∂–¥—ë—Ç 10:00¬†–ú–°–ö.
2. –ó–∞–ø—Ä–æ—Å: `GET ${GAP_SCANNER_URL}?min_gap=${MIN_GAP}`.
3. JSON‚Äë–æ—Ç–≤–µ—Ç —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è, –±–µ—Ä—ë—Ç—Å—è `results`.
4. –ó–∞–ø—Ä–æ—Å: `GET ${VWAP_LEVELS_URL}` —Å JSON `{ticker, uid, date}`.
5. –û—Ç–≤–µ—Ç (`vwap`, `support`, `resistance`) –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª.
6. –°–∫—Ä–∏–ø—Ç ¬´—Å–ø–∏—Ç¬ª –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞.

–ü–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏–∑ HTTP‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —É—Ä–æ–≤–Ω–µ–º `ERROR`, —Ä–µ—Ç—Ä–∞–µ–≤ –Ω–µ—Ç ‚Äî –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é.

---

## üóÑÔ∏è –õ–æ–≥–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

*–ü–æ‚Äë—É–º–æ–ª—á–∞–Ω–∏—é* –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–∏—à–µ—Ç —Ç–æ–ª—å–∫–æ –≤ stdout ‚Üí `docker logs orchestrator`.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
orchestrator/
‚î£ orchestrator.py         # –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
‚î£ pyproject.toml          # –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ uv    
‚îó Dockerfile              # python:3.13‚Äëslim, ENTRYPOINT ["uv", "run", "orchestrator.py"]
```

---

### ‚ú® –ì–æ—Ç–æ–≤–æ

–ü–æ—Å–ª–µ –ø–æ–¥–Ω—è—Ç–∏—è —Å—Ç–µ–∫–∞ `docker compose up` –≤—Å–µ —Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ–±—Ä–∞–∑—É—é—Ç —Å–≤—è–∑–∫—É:

* **gap‚Äëscanner** ‚Äî REST¬†API –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–∏—Ö –≥—ç–ø–æ–≤
* **vwap‚Äëlevels** ‚Äî REST¬†API –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ VWAP
* **orchestrator** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –∫–ª–µ—è—â–∏–π –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Ä–æ–≤–Ω–æ –≤¬†10:00¬†–ø–æ¬†–ú–æ—Å–∫–≤–µ.
