uv run uvicorn gap_and_go:app --host 0.0.0.0 --port 8002
curl -s "http://localhost:8002/gap-and-go?ticker=VEON-RX&uid=f1374f83-7934-41f7-a210-097ed5beecd5&date=2025-07-28"

Логика стратегии: Имплементируем функцию analyze_gap_and_go(uid: str, date: datetime.date)) которая обращается к Tinkoff Invest API за минутными свечами первого торгового часа указанной акции. Можно воспользоваться подходом из VWAP-сервиса: вызвать client.market_data.get_candles с интервалом CandleInterval.CANDLE_INTERVAL_1_MIN на интервал [начало торгового дня; +5 минут] либо на весь день и потом обработать первые 5 минут
GitHub
. Пример получения минутных свечей за день (из VWAP Levels)
GitHub
:
candles = client.market_data.get_candles(
   instrument_id=uid,
   from_=from_ts,
   to=to_ts,
   interval=CandleInterval.CANDLE_INTERVAL_1_MIN,
).candles
if not candles:
   raise ValueError(f"Нет минутных свечей за {date_}")  # обработка отсутствия данных:contentReference[oaicite:22]{index=22}
Получив список минутных свечей за день, выбираем первую минутную свечу после открытия (обычно это candles[0], если API возвращает отсортированные данные с начала дня). Вычисляем параметры первой свечи:
first_open – цена открытия первой минуты (можно получить из candles[0].open).
first_high – максимум первой минуты (candles[0].high).
first_low – минимум первой минуты (candles[0].low).
first_close – цена закрытия первой минуты (candles[0].close).
Чтобы соответствовать условию “сильный рост в первую минуту”, можно ввести проверку: первая свеча должна быть бычьей и достаточного размера. Например, проверить, что first_close > first_open (рост за первую минуту) и/или что разница first_close - first_open составляет хотя бы определенный процент от цены открытия (например >0.5% или другой критерий). Это отфильтрует случаи, когда после гэпа цена сразу падает или топчется на месте. Далее реализуем определение пробоя high первой свечи: просматриваем несколько следующих минутных свечей (например, до 5-й минуты включительно, т.е. candles[1] ... candles[4], что охватывает первые ~5 минут торгов). Если хотя бы в одной из этих свечей максимум (high) превышает first_high первой минуты, значит произошел пробой. Находим первую свечу, где high > first_high – момент входа по стратегии.
Entry (вход): уровень пробоя high первой свечи. В реальной торговле вход производится при цене чуть выше first_high (например, +1 тик), но для простоты можно считать entry_price = first_high (или сообщить этот уровень как точку входа).
Stop-loss: нижняя граница первой свечи. Стратегия предполагает стоп под low первой минуты, т.е. stop_price = first_low.
Время пробоя: можно зафиксировать время (timestamp) той минуты, где случился пробой, для информации.
Формируем результат в виде JSON-словаря. Например:
{
  "ticker": "XXXX",
  "date": "2025-07-28",
  "first_candle_high": 10.50,
  "first_candle_low": 9.80,
  "triggered": true,
  "entry_price": 10.50,
  "stop_price": 9.80,
  "trigger_time": "2025-07-28T09:01:00Z"
}
Здесь triggered – флаг, произошел ли пробой high в первые 5 минут. Если пробоя не было (triggered: false), поля entry_price, stop_price можно либо опустить, либо оставить равными high/low, а trigger_time не указывать. Поля first_candle_high и low полезны для анализа даже если не было входа.