

# Bull-Flag ‚Äì –≤–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è ¬´–±—ã—á–∏–π —Ñ–ª–∞–≥¬ª

**Bull-Flag** ‚Äî HTTP‚Äë—Å–µ—Ä–≤–∏—Å (FastAPI), –∫–æ—Ç–æ—Ä—ã–π *–¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞ –∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –¥–Ω—è* –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —Å—Ä–∞–±–æ—Ç–∞–ª –ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω ¬´–±—ã—á–∏–π —Ñ–ª–∞–≥¬ª (Bull Flag) –Ω–∞ 1‚Äë –∏ 5‚Äë–º–∏–Ω—É—Ç–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞—Ö.

1. –ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏ (Tinkoff Invest API) 1‚ÄØ–º–∏–Ω –∏‚ÄØ5‚ÄØ–º–∏–Ω –∑–∞ —Å—É—Ç–∫–∏ (UTC).
2. –ù–∞—Ö–æ–¥–∏—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π ¬´—Ñ–ª–∞–≥—à—Ç–æ–∫¬ª ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞–∫—Å–∏–º—É–º —Å –º–æ—â–Ω—ã–º –∏–º–ø—É–ª—å—Å–æ–º.
3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—é —Å –ø–æ–Ω–∏–∂–∞—é—â–∏–º–∏—Å—è –ø–∏–∫–∞–º–∏ (–ø–æ–ª–æ—Ç–Ω–æ —Ñ–ª–∞–≥–∞).
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ–±–æ–π –≤–≤–µ—Ä—Ö —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –æ–±—ä—ë–º–∞ **‚â•‚ÄØ2√ó** —Å—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä—ë–º–∞ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏.
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø–æ –¥–≤—É–º —Ç–∞–π–º‚Äë—Ñ—Ä–µ–π–º–∞–º:
   * Bull‚ÄëFlag 1‚ÄØ–º
   * Bull‚ÄëFlag 5‚ÄØ–º  
   –î–ª—è –∫–∞–∂–¥–æ–≥–æ: `triggered`, `entry_price`, `stop_price`, `target_price`, `trigger_time`.

–°–µ—Ä–≤–∏—Å —É–ø–∞–∫–æ–≤–∞–Ω –≤ Docker‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –∏–ª–∏ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.

---

## ‚öôÔ∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Python ‚â•‚ÄØ3.13**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` ‚Üí `.env` –∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```dotenv
# –¢–æ–∫–µ–Ω Tinkoff Invest API
TINKOFF_INVEST_TOKEN=your_token_here
# –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Moscow)
TZ=Europe/Moscow
# –ü–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç —Å–µ—Ä–≤–∏—Å
PORT=8004
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install uv
```

### 2. –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
uv run uvicorn bull_flag:app --host 0.0.0.0 --port 8004
```

–ü—Ä–æ–≤–µ—Ä—å –∑–∞–ø—Ä–æ—Å–æ–º:

```bash
curl -s "http://localhost:8004/bull-flag?ticker=SBER&uid=f0eac4d5-4753-4c05-857e-676f25c18e68&date=2025-07-28"
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

```json
{
  "ticker": "SBER",
  "date": "2025-07-28",
  "bull_flag_1min": {
    "triggered": true,
    "entry_price": 277.80,
    "stop_price": 273.65,
    "target_price": 282.40,
    "trigger_time": "2025-07-28T08:17:00+00:00"
  },
  "bull_flag_5min": {
    "triggered": false,
    "entry_price": null,
    "stop_price": null,
    "target_price": null,
    "trigger_time": null
  }
}
```

### 3. –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
docker compose up bull_flag
```

`docker-compose.yml` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ—Ä–≤–∏—Å **bull_flag** —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –ø–æ—Ä—Ç–∞ `8004`.

---

## üß∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                              |
| ----------------------- | ----------- | --------------- | --------------------------------------- |
| `TINKOFF_INVEST_TOKEN`  | –¥–∞          | ‚Äî               | –î–æ—Å—Ç—É–ø –∫ Market¬†Data¬†API Tinkoff        |
| `TZ`                    | –Ω–µ—Ç         | `Europe/Moscow` | –õ–æ–∫–∞–ª—å–Ω–∞—è —Ç–∞–π–∑–æ–Ω–∞ –¥–ª—è –ª–æ–≥–æ–≤             |
| `PORT`                  | –Ω–µ—Ç         | `8004`          | –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–ª—É—à–∞–µ—Ç FastAPI        |

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç **GET** `/bull-flag?ticker&uid&date`.
2. –°–µ—Ä–≤–∏—Å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–≤–µ—á–∏:
   * `CANDLE_INTERVAL_1_MIN`
   * `CANDLE_INTERVAL_5_MIN`  
   –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ *[00:00¬†UTC –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è; 00:00¬†UTC —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è]*.
3. –ê–ª–≥–æ—Ä–∏—Ç–º Bull‚ÄëFlag:
   1. –ò—â–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞–∫—Å–∏–º—É–º (–≤–µ—Ä—à–∏–Ω—É —Ñ–ª–∞–≥—à—Ç–æ–∫–∞), –≥–¥–µ —Å–æ—Å–µ–¥–Ω–∏–µ —Å–≤–µ—á–∏ –∏–º–µ—é—Ç –Ω–∏–∂–µ high.
   2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å–ª–µ–¥—É—é—â–∏–µ ‚â•‚ÄØ2 —Å–≤–µ—á–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –ø–æ–Ω–∏–∂–∞—é—â–∏–µ—Å—è –ø–∏–∫–∏ (–∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è).
   3. –§–∏–∫—Å–∏—Ä—É–µ—Ç **—Å–∞–º—É—é –Ω–∏–∑–∫—É—é —Ü–µ–Ω—É** –≤ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏ (stop‚Äëloss).
   4. –ñ–¥—ë—Ç —Å–≤–µ—á—É‚Äë–ø—Ä–æ–±–æ–π —Å high¬†> –≤–µ—Ä—à–∏–Ω—ã —Ñ–ª–∞–≥—à—Ç–æ–∫–∞ –∏ –æ–±—ä—ë–º–æ–º ‚â•‚ÄØ2√ó —Å—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä—ë–º–∞ –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏.
   5. –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏:
      * `entry_price` = –≤–µ—Ä—à–∏–Ω–∞ —Ñ–ª–∞–≥—à—Ç–æ–∫–∞;
      * `stop_price` = –º–∏–Ω–∏–º—É–º –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏–∏;
      * `target_price` = `entry_price` + –≤—ã—Å–æ—Ç–∞ —Ñ–ª–∞–≥—à—Ç–æ–∫–∞;
      * `trigger_time` = —à—Ç–∞–º–ø –ø—Ä–æ–±–æ–π–Ω–æ–π —Å–≤–µ—á–∏.
4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Pydantic –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É.
5. –í –ª–æ–≥–∏ (`INFO`) –ø–∏—à—É—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è; –æ—à–∏–±–∫–∏ API ‚Äî —É—Ä–æ–≤–Ω–µ–º `ERROR`.

---

## üóÑÔ∏è –õ–æ–≥–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–∏—Å –ø–∏—à–µ—Ç –≤ stdout ‚Üí `docker logs bull_flag`.  
–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `uvicorn` –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤: `--log-level debug` ‚Äî –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–≤–µ—á–∏ –∏ –ø–æ—à–∞–≥–æ–≤—ã–π —Ö–æ–¥ –∞–ª–≥–æ—Ä–∏—Ç–º–∞.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bull_flag/
‚î£ bull_flag.py             # FastAPI‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ª–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚î£ DockerfileBullFlag       # python:3.13‚Äëslim, ENTRYPOINT ["uv", "run", "uvicorn ..."]
‚îó README_BullFlag.md       # —ç—Ç–æ—Ç —Ñ–∞–π–ª
```

---

### ‚ú® –ì–æ—Ç–æ–≤–æ

–ü–æ—Å–ª–µ `docker compose up` –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

* **bull_flag** ‚Äî REST¬†API —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ Bull‚ÄëFlag
* **orchestrator** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã –∏ –ª–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å –≤ —Å–≤–æ–∏ —Ç—Ä–µ–π–¥–∏–Ω–≥‚Äë—Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ –≤—ã–∑—ã–≤–∞–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ cURL/Postman.