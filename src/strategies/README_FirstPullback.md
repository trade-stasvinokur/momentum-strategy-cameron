## FirstยPullback โ ะฒะฝัััะธะดะฝะตะฒะฝะฐั ัััะฐัะตะณะธั ยซะฟะตัะฒัะนโฏะพัะบะฐัยป

**FirstโฏPullback** โ ะปัะณะบะธะน HTTPโัะตัะฒะธั (FastAPI), ะบะพัะพััะน *ะดะปั ะทะฐะดะฐะฝะฝะพะณะพ ัะธะบะตัะฐ ะธ ัะพัะณะพะฒะพะณะพ ะดะฝั* ะพะฟัะตะดะตะปัะตั, ะฟะพัะฒะธะปััยะปะธ ัะธะณะฝะฐะป ยซะฟะตัะฒะพะณะพ ะพัะบะฐัะฐยป ะฝะฐ ัะฐะนะผโััะตะนะผะฐั 1โฏะผะธะฝ ะธย5โฏะผะธะฝ.

1. ะะฐะณััะถะฐะตั ะธััะพัะธัะตัะบะธะต ัะฒะตัะธ ัะตัะตะท TinkoffโฏInvestยAPI: ะฟะตัะฒัะตย15โฏะผะธะฝ (1โฏะผะธะฝ) ะธย30โฏะผะธะฝ (5โฏะผะธะฝ) ะฟะพัะปะต ะพัะบัััะธั ัะตััะธะธย([developer.tinkoff.ru][5]).
2. ะคะธะบัะธััะตั ััะฐััะพะฒัะน ะธะผะฟัะปัั (ะฟะตัะฒะฐั ัะฒะตัะฐ, ะพะฑะฝะพะฒะปัััะฐั ะผะฐะบัะธะผัะผ) ะธ ะตะณะพ ะฟะธะบ.
3. ะััะปะตะถะธะฒะฐะตั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััั ัะฒะตัะตะน, ะฝะต ะฟัะพะฑะธะฒะฐััะธั ะผะฐะบัะธะผัะผ (ะพัะบะฐั).
4. ะัะพะฒะตััะตั ััะปะพะฒะธั ะบะฐัะตััะฒะฐ:

   * ะธะผะฟัะปััยโฅโฏ3โฏ% ะพั ัะตะฝั ะพัะบัััะธั ย([Warrior Trading][6]);
   * ะพะฑััะผ ะบะฐะถะดะพะน ะพัะบะฐัะฝะพะน ัะฒะตัะธ < ะพะฑััะผะฐ ะธะผะฟัะปััะฐย([Warrior Trading][3]);
   * ะณะปัะฑะธะฝะฐ ะพัะบะฐัะฐ โคโฏ50โฏ% ะฒััะพัั ะธะผะฟัะปััะฐย([Reddit][4]).
5. ะัะปะธ ัะปะตะดัััะฐั ัะฒะตัะฐ ะฟัะพะฑะธะฒะฐะตั ัะฐะน ะฟะพัะปะตะดะฝะตะน ะพัะบะฐัะฝะพะน ะธ ะพะฑััะผ ะพััะฐัััั ะฒััะพะบะธะผ, ะฟะฐััะตัะฝ ััะธัะฐะตััั ััะฐะฑะพัะฐะฒัะธะผ ะธ ัะฐัััั ะฒัะดะฐัั `entry_price`, `stop_price`, `target_price`, `trigger_time`.

ะกะตัะฒะธั ะณะพัะพะฒ ะบยDockerโัะฐะทะฒััััะฒะฐะฝะธั ะปะธะฑะพ ะฒัะทะพะฒั ะฝะฐะฟััะผัั ะธะท ะพัะบะตัััะฐัะพัะฐ.

---

## โ๏ธ ะัััััะน ััะฐัั

### 1. ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั

1. **Pythonโฏโฅโฏ3.13**.
2. ะกะบะพะฟะธััะนัะต `.env.example` โ `.env` ะธ ะทะฐะดะฐะนัะต ะฟะตัะตะผะตะฝะฝัะต:

```dotenv
# ะขะพะบะตะฝ Tinkoff Invest API
TINKOFF_INVEST_TOKEN=your_token_here
# ะงะฐัะพะฒะพะน ะฟะพัั (ะดะปั ะปะพะณะพะฒ)
TZ=Europe/Moscow
# ะะพัั, ะบะพัะพััะน ัะปััะฐะตั ัะตัะฒะธั
PORT=8005
```

3. ะะฐะฒะธัะธะผะพััะธ:

```bash
pip install uv
```

### 2. ะะฐะฟััะบ ะปะพะบะฐะปัะฝะพ

```bash
uv run uvicorn first_pullback:app --host 0.0.0.0 --port 8005
```

ะัะพะฒะตัะบะฐ:

```bash
curl -s "http://localhost:8005/first-pullback?ticker=SBER&uid=f0eac4d5-4753-4c05-857e-676f25c18e68&date=2025-07-28"
```

ะัะธะผะตั ะพัะฒะตัะฐ:

```json
{
  "ticker": "SBER",
  "date": "2025-07-28",
  "first_pullback_1min": {
    "triggered": true,
    "entry_price": 277.10,
    "stop_price": 274.45,
    "target_price": 282.30,
    "trigger_time": "2025-07-28T07:06:00+00:00"
  },
  "first_pullback_5min": {
    "triggered": false,
    "entry_price": null,
    "stop_price": null,
    "target_price": null,
    "trigger_time": null
  }
}
```

### 3. ะะฐะฟััะบ ะฒ Docker

```bash
docker compose up first_pullback
```

`docker-compose.yml` ัะถะต ัะพะดะตัะถะธั ัะตัะฒะธั **first\_pullback** ั ะฟัะฑะปะธะบะฐัะธะตะน ะฟะพััะฐย`8005`.

---

## ๐งฐ ะะพะฝัะธะณััะฐัะธั

| ะะตัะตะผะตะฝะฝะฐั             | ะะฑัะทะฐัะตะปัะฝะพ | ะะพ ัะผะพะปัะฐะฝะธั    | ะะฐะทะฝะฐัะตะฝะธะต                                                   |
| ---------------------- | ----------- | --------------- | ------------------------------------------------------------ |
| `TINKOFF_INVEST_TOKEN` | ะดะฐ          | โ               | ะะพัััะฟ ะบยMarketโฏDataยAPIยTinkoffย([developer.tinkoff.ru][5]) |
| `TZ`                   | ะฝะตั         | `Europe/Moscow` | ะะพะบะฐะปัะฝะฐั ัะฐะนะทะพะฝะฐ ะดะปั ะปะพะณะพะฒ                                  |
| `PORT`                 | ะฝะตั         | `8005`          | ะะพัั, ะฝะฐยะบะพัะพัะพะผ ัะปััะฐะตั FastAPI                             |

---

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

1. ะะปะธะตะฝั ะดะตะปะฐะตั **GET** `/first-pullback?ticker&uid&date`.
2. ะกะตัะฒะธั ะทะฐะฟัะฐัะธะฒะฐะตั ัะฒะตัะธ:

   * `CANDLE_INTERVAL_1_MIN` (ะฟะตัะฒัะตย15โฏะผะธะฝ);
   * `CANDLE_INTERVAL_5_MIN` (ะฟะตัะฒัะตย30โฏะผะธะฝ).
3. ะะปะณะพัะธัะผ FirstโฏPullback:

   1. ะคะธะบัะธััะตั ัะตะฝั ะพัะบัััะธั ะธ ะฟะธะบะพะฒัะน ัะฐะน ะธะผะฟัะปััะฐ.
   2. ะะฟัะตะดะตะปัะตั ััะฐัั ะพัะบะฐัะฐ โ ะฟะตัะฒัั ัะฒะตัั ะฑะตะท ะพะฑะฝะพะฒะปะตะฝะธั ัะฐั.
   3. ะกัะธัะฐะตั ะผะธะฝะธะผัะผ ะพัะบะฐัะฐ ะธ ะพะฑััะผ ะบะฐะถะดะพะน ัะฒะตัะธ.
   4. ะัะพะฒะตััะตั ะฟัะฐะฒะธะปะฐ ยซะบะฐัะตััะฒะตะฝะฝะพะณะพยป ะพัะบะฐัะฐ (ัะผ. ะฒััะต).
   5. ะัะธ ะฟะพะดัะฒะตัะถะดะตะฝะธะธ:

      * `entry_price`ย= ัะฐะน ะฟะพัะปะตะดะฝะตะน ะพัะบะฐัะฝะพะน ัะฒะตัะธ;
      * `stop_price`ย= ะผะธะฝะธะผัะผ ะพัะบะฐัะฐ;
      * `target_price`ย= ะฟะธะบ ะธะผะฟัะปััะฐ;
      * `trigger_time`ย= ะฒัะตะผั ะฟัะพะฑะพะนะฝะพะน ัะฒะตัะธ.
4. ะะตะทัะปััะฐั ัะตัะธะฐะปะธะทัะตััั ัะตัะตะท Pydantic ะธ ะฒะพะทะฒัะฐัะฐะตััั ะบะปะธะตะฝัั.
5. ะะพะณะธัะพะฒะฐะฝะธะต (`INFO`)ยโ ะบะปััะตะฒัะต ััะฐะฟั ะธ ะฟะฐัะฐะผะตััั; ะฟัะพะฑะปะตะผั MarketโฏDataยAPIยโ `ERROR`. CORS ะฝะฐัััะพะตะฝ ะฝะฐ `'*'` ะดะปั ะฟัะพััะพัั ะธะฝัะตะณัะฐัะธะธ.

---

## ๐๏ธ ะะพะณะธ ะธ ััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั

ะะพยัะผะพะปัะฐะฝะธั ัะตัะฒะธั ะฟะธัะตั ะฒยstdout โ `docker logs first_pullback`. ะะปั ะดะตัะฐะปัะฝะพะน ะพัะปะฐะดะบะธ ะผะพะถะฝะพ ะทะฐะฟัััะธัั `uvicorn` ั `--log-level debug` ะธ ะฒะธะดะตัั ะฒัะต ะฟัะธัะตะดัะธะต ัะฒะตัะธ.

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
first_pullback/
โฃ first_pullback.py        # FastAPIโะฟัะธะปะพะถะตะฝะธะต ะธ ะปะพะณะธะบะฐ ัััะฐัะตะณะธะธ
โฃ DockerfileFirstPullback  # python:3.13โslim, ENTRYPOINT ["uv", "run", "uvicorn ..."]
โ README_FirstPullback.md  # ััะพั ัะฐะนะป
```

---

### โจ ะะพัะพะฒะพ

ะะพัะปะต `docker compose up` ะพะบััะถะตะฝะธะต ัะพะดะตัะถะธั:

* **first\_pullback** โ RESTยAPI ัััะฐัะตะณะธะธ FirstโฏPullback
* (ะพะฟัะธะพะฝะฐะปัะฝะพ) **orchestrator** โ ะฟะปะฐะฝะธัะพะฒัะธะบ, ะบะพัะพััะน ะฟะพยัะฐัะฟะธัะฐะฝะธั ะฒัะทัะฒะฐะตั ัััะฐัะตะณะธั ะธ ัะบะปะฐะดัะฒะฐะตั ัะตะทัะปััะฐัั ะฒยะะ/ะปะพะณ.

ะัะฟะพะปัะทัะนัะต ัะตัะฒะธั ะฝะฐะฟััะผัั ัะตัะตะท cURL/Postman ะธะปะธ ะธะผะฟะพััะธััะนัะต ัะฝะดะฟะพะธะฝั ะฒยัะฒะพะธ ััะตะนะดะธะฝะณโัะบัะธะฟัั.